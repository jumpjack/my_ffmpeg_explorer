<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FFmpeg.js Example</title>
</head>
<body>
  <input type="file" id="inputFile" accept="video/*">
  <button onclick="convertVideo()">Convert Video</button>
  <progress id="progressBar" value="0" max="100"></progress>
  <p id="status"></p>

  <script src="https://cdn.jsdelivr.net/npm/ffmpeg.js"></script>

  <script>
    const inputFile = document.getElementById('inputFile');
    const progressBar = document.getElementById('progressBar');
    const status = document.getElementById('status');
    let ffmpeg = null;

    inputFile.addEventListener('change', (event) => {
      const file = event.target.files[0];
      ffmpeg = createFFmpeg({
        log: true,
        corePath: 'https://cdn.jsdelivr.net/npm/ffmpeg.js/ffmpeg-core.js'
      });
      ffmpeg.setProgress(({ ratio }) => {
        progressBar.value = ratio * 100;
      });
      ffmpeg.setLogger(({ message }) => {
        status.textContent = message;
      });

      const loadFFmpeg = async () => {
        await ffmpeg.load();
        status.textContent = 'File loaded. Ready to convert.';
      };

      loadFFmpeg();
      ffmpeg.FS('writeFile', file.name, await fetchFile(file));
    });

    async function convertVideo() {
      if (!ffmpeg) {
        status.textContent = 'Please select a file first.';
        return;
      }

      const file = inputFile.files[0];
      const outputFileName = 'output.mp4';
      status.textContent = 'Converting...';
      await ffmpeg.run('-i', file.name, outputFileName);
      const data = ffmpeg.FS('readFile', outputFileName);
      const blob = new Blob([data.buffer], { type: 'video/mp4' });

      // Download the converted video
      const downloadLink = document.createElement('a');
      downloadLink.href = URL.createObjectURL(blob);
      downloadLink.download = outputFileName;
      downloadLink.click();

      status.textContent = 'Conversion completed.';
    }
  </script>
</body>
</html>
